## Описание

Бот предоставляет следующие основные функции:
- Отправка текстовых запросов к модели `gpt-3.5-turbo` и получение ответов.
- Поддержка голосовых сообщений (в текущей версии закомментирована часть кода для их обработки).
- Управление контекстами разговора: создание, переключение, переименование и сброс.
- Логирование взаимодействия в файл `latest.log`.
- Ограничение доступа для пользователей (управляется администратором через команду `/change_access`).
- Хранение данных о пользователях, контекстах и сообщениях в базе данных SQLite (`db.sqlite`).

**Примечание**: Код не актуален и требует обновления для работы с последними версиями библиотек и API.

## Требования

Для работы бота необходимы:
- Python 3.8 или выше
- Установленный `pip` для управления зависимостями
- Токен Telegram-бота, полученный через [@BotFather](https://t.me/BotFather)
- API-ключ OpenAI, полученный через [OpenAI Platform](https://platform.openai.com/)
- SQLite (встроен в Python, дополнительных установок не требуется)

## Установка

1. **Клонируйте репозиторий**:
   ```bash
   git clone https://github.com/jsfrau/tg_bot.git
   cd tg_bot
   ```

2. **Установите зависимости**:
   Установите необходимые библиотеки с помощью `pip`. Точный список зависимостей отсутствует в файле `requirements.txt`, но на основе кода требуются следующие пакеты:
   ```bash
   pip install python-telegram-bot openai python-dotenv
   ```
   **Примечание**: Возможны дополнительные зависимости (например, для обработки голосовых сообщений), которые закомментированы в коде.

3. **Настройте переменные окружения**:
   Создайте файл `.env` в корневой директории проекта и добавьте свои ключи:
   ```
   OPENAI_API_KEY=your_openai_api_key_here
   TELEGRAM_API_KEY=your_telegram_bot_token_here
   ```
   Пример файла `.env` уже предоставлен, но ключи в нем не следует использовать в продакшене.

4. **Инициализируйте базу данных**:
   База данных SQLite (`db.sqlite`) создается автоматически при запуске `bot.py`. Убедитесь, что у вас есть права на запись в директории проекта.

## Использование

1. **Запустите бота**:
   Выполните команду в терминале:
   ```bash
   python bot.py
   ```

2. **Команды бота**:
   - `/start` — Регистрация пользователя и создание первого контекста.
   - `/stop` — Удаление пользователя и всех его данных.
   - `/reset` — Сброс текущего контекста (удаление всех сообщений, кроме системных).
   - `/change` — Выбор другого контекста через интерактивное меню.
   - `/rename <название>` — Переименование текущего контекста.
   - `/remove` — Удаление текущего контекста и переключение на последний доступный.
   - `/change_access @username` — Изменение статуса доступа пользователя (только для администратора с ID `513525121`).

3. **Отправка сообщений**:
   Просто отправьте текст в чат с ботом, и он ответит с использованием модели GPT. Контекст разговора сохраняется в базе данных.

## Вклад

Если вы хотите внести вклад в проект, начните с обновления кода:
- Перепишите асинхронные вызовы OpenAI для использования последней версии библиотеки.
- Добавьте поддержку обработки голосовых сообщений (раскомментируйте и обновите код с `ffmpeg` и `openai.Audio`).
- Создайте файл `requirements.txt` для точного указания зависимостей.
- Исправьте потенциальные проблемы с безопасностью (например, hardcoded ключи в коде).

Форкните репозиторий, внесите изменения и отправьте pull request.

---

**Важное замечание**: Этот код устарел и требует переработки. Он может не работать с текущими версиями библиотек `python-telegram-bot` и `openai`. Рекомендуется обновить зависимости, переписать асинхронные вызовы и устранить hardcoded значения ключей для использования в продакшене.

---
